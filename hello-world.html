<script>
(function(window, document, undefined) {

    class TestElement extends HTMLElement {
        connectedCallback () {
            this.attachShadow({mode: 'open'});
            this.render();
            this.subscribeObservable();
        }

        render () {
            this.renderHelloDiv();
            this.renderNotificationButton();
            this.renderObservableButton();
        }

        subscribeObservable() {
            this.dispatchEvent(new CustomEvent('subscribeObservable', {
                detail: {
                    key:"webcomponent-test",
                    callback: function(newValue) {
                        alert(newValue);
                    }
                }
            }));
        }

        renderHelloDiv() {
            const div = document.createElement('div');
            div.classList.add('header');
            div.innerHTML = "Hello " + this.getWho();
            this.shadowRoot.appendChild(div);
        }

        renderObservableButton() {
            const button = document.createElement('button');
            button.innerHTML = "Change observable";
            this.shadowRoot.appendChild(button);

            var self = this;
            button.addEventListener("click", function() {
                self.dispatchEvent(new CustomEvent('changeObservable', {
                    detail: {
                        key:"webcomponent-test",
                        value: "test value"
                    }
                }));
            });
        }

        renderNotificationButton() {
            const button = document.createElement('button');
            button.innerHTML = "Send notification";
            this.shadowRoot.appendChild(button);

            var self = this;
            button.addEventListener("click", function() {
                self.dispatchEvent(new CustomEvent('sendNotification', {
                    detail: {
                        title: "New notification",
                        priority: "MAJOR",
                        categoryType: "alarm",
                        message: "Notification description"
                    }
                }));
            });
        }

        getWho() {
            if(this.hasAttribute("who")) {
                return this.getAttribute("who");
            }
            return "World!";
        }
    }

    // Registers <hello-world> in the main document
    customElements.define('hello-world', TestElement)
})(window, document);
</script>